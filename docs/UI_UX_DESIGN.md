# UI/UX設計書（UI/UX Design Document）

## 1. 概要

本ドキュメントは、競馬賭けシミュレーションシステムのユーザーインターフェース設計を定義する。CLI、Jupyterノートブック、Streamlitダッシュボードの3段階でインターフェースを提供する。

---

## 2. インターフェース戦略

### 2.1 段階的実装アプローチ

| Phase | インターフェース | 対象ユーザー | 用途 |
|-------|-----------------|-------------|------|
| Phase 1 | CLI + 静的グラフ（PNG） | 開発者 | 基本機能の検証 |
| Phase 2 | Jupyter Notebook | 分析者 | 詳細分析・パラメータ検討 |
| Phase 3 | Streamlit Dashboard | 一般ユーザー | 日常的な運用・モニタリング |

### 2.2 共通デザイン原則

1. **一貫性**: 全インターフェースで用語・色・アイコンを統一
2. **視認性**: 重要な指標を目立たせる
3. **操作性**: 最小限のクリック/入力で目的達成
4. **応答性**: 処理状況をリアルタイム表示
5. **エラー対応**: わかりやすいエラーメッセージ

---

## 3. カラースキーム・デザインシステム

### 3.1 カラーパレット

```css
/* プライマリカラー */
--primary-500: #3B82F6;      /* メインブルー */
--primary-600: #2563EB;      /* ダークブルー */
--primary-400: #60A5FA;      /* ライトブルー */

/* セマンティックカラー */
--success: #10B981;          /* 緑（プラス・的中） */
--danger: #EF4444;           /* 赤（マイナス・不的中） */
--warning: #F59E0B;          /* 黄（警告・注意） */
--info: #3B82F6;             /* 青（情報） */

/* ニュートラル */
--gray-50: #F9FAFB;          /* 背景 */
--gray-100: #F3F4F6;         /* カード背景 */
--gray-500: #6B7280;         /* 補助テキスト */
--gray-900: #111827;         /* メインテキスト */

/* チャート専用 */
--chart-line: #3B82F6;       /* メイン線 */
--chart-area: rgba(59, 130, 246, 0.1);  /* 塗りつぶし */
--chart-positive: #10B981;   /* 上昇 */
--chart-negative: #EF4444;   /* 下降 */
--chart-band: rgba(107, 114, 128, 0.2); /* 信頼区間 */
```

### 3.2 タイポグラフィ

| 用途 | フォント | サイズ | ウェイト |
|------|---------|--------|---------|
| 見出し1 | Noto Sans JP | 24px | Bold |
| 見出し2 | Noto Sans JP | 20px | Bold |
| 見出し3 | Noto Sans JP | 16px | SemiBold |
| 本文 | Noto Sans JP | 14px | Regular |
| キャプション | Noto Sans JP | 12px | Regular |
| 数値（大） | Roboto Mono | 32px | Bold |
| 数値（小） | Roboto Mono | 14px | Regular |

### 3.3 アイコン

| 用途 | アイコン | 説明 |
|------|---------|------|
| 利益 | 📈 / ↑ | 緑色で表示 |
| 損失 | 📉 / ↓ | 赤色で表示 |
| 的中 | ✅ / ⭕ | 緑色 |
| 不的中 | ❌ | 赤色 |
| Go判定 | ✅ GO | 緑バッジ |
| No-Go判定 | ⚠️ NO-GO | 赤バッジ |
| 警告 | ⚠️ | 黄色 |
| 情報 | ℹ️ | 青色 |

---

## 4. CLI インターフェース設計

### 4.1 出力フォーマット

#### 4.1.1 進捗表示

```
🏇 競馬賭けシミュレーション v1.0.0
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📁 入力ファイル: predictions_2025.tsv
📊 レース数: 1,234 件
🎯 戦略: favorite_win（予測1位単勝）
💰 初期資金: ¥100,000

[████████████████████████████████████████] 100% 完了

⏱️ 処理時間: 2.34秒
```

#### 4.1.2 結果サマリー

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 シミュレーション結果サマリー
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💰 収益指標
   最終資金:     ¥135,420 (+35,420)
   ROI:          135.42%
   年率リターン:  42.5%

📉 リスク指標
   最大DD:       18.5%
   破産確率:     2.3%
   シャープレシオ: 1.45

🎯 的中指標
   的中率:       30.0% (156/520)
   回収率:       135.42%
   最大連敗:     12連敗

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Go/No-Go判定: GO
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📁 出力ファイル:
   - output/simulation_result.json
   - output/fund_history.csv
   - output/bet_history.csv
   - output/charts/fund_history.png
```

#### 4.1.3 エラー表示

```
❌ エラー: 入力ファイルの読み込みに失敗しました

   ファイル: predictions_2025.tsv
   行番号: 156
   カラム: 単勝オッズ
   
   問題: 数値として解析できない値 "N/A" が含まれています
   
   💡 ヒント: 単勝オッズは正の数値である必要があります
              欠損値は除外するか、適切な数値に置き換えてください
```

---

## 5. Jupyter Notebook テンプレート設計

### 5.1 ノートブック一覧

| ファイル名 | 用途 | 主要セクション |
|-----------|------|---------------|
| 01_basic_simulation.ipynb | 基本シミュレーション | データ読込→シミュレーション→結果表示 |
| 02_strategy_comparison.ipynb | 戦略比較 | 複数戦略の並列実行・比較 |
| 03_monte_carlo_analysis.ipynb | モンテカルロ分析 | 確率分布・リスク詳細分析 |
| 04_walk_forward_analysis.ipynb | Walk-Forward分析 | 期間別パフォーマンス |
| 05_risk_analysis.ipynb | リスク詳細分析 | VaR/CVaR/ドローダウン深掘り |
| 06_parameter_tuning.ipynb | パラメータチューニング | グリッドサーチ・感度分析 |

### 5.2 ノートブック構造テンプレート

```markdown
# 📊 [ノートブックタイトル]

## 1. セットアップ
- ライブラリインポート
- 設定読込

## 2. データ読込
- TSVファイル読込
- データ概要確認

## 3. シミュレーション実行
- パラメータ設定
- 実行

## 4. 結果分析
- 指標計算
- グラフ表示

## 5. 考察
- 結果の解釈
- 次のアクション
```

### 5.3 インタラクティブウィジェット

```python
import ipywidgets as widgets
from IPython.display import display

# 戦略選択
strategy_dropdown = widgets.Dropdown(
    options=['favorite_win', 'box_quinella', 'value_win'],
    value='favorite_win',
    description='戦略:',
    style={'description_width': '100px'}
)

# 初期資金スライダー
initial_fund_slider = widgets.IntSlider(
    value=100000,
    min=10000,
    max=1000000,
    step=10000,
    description='初期資金:',
    style={'description_width': '100px'}
)

# ケリーフラクション
kelly_slider = widgets.FloatSlider(
    value=0.25,
    min=0.1,
    max=1.0,
    step=0.05,
    description='Kelly %:',
    style={'description_width': '100px'}
)

# 実行ボタン
run_button = widgets.Button(
    description='シミュレーション実行',
    button_style='primary',
    icon='play'
)

# 出力エリア
output = widgets.Output()

def on_run_click(b):
    with output:
        output.clear_output()
        # シミュレーション実行
        pass

run_button.on_click(on_run_click)

# レイアウト
display(widgets.VBox([
    widgets.HBox([strategy_dropdown, initial_fund_slider]),
    widgets.HBox([kelly_slider]),
    run_button,
    output
]))
```

---

## 6. Streamlit ダッシュボード設計

### 6.1 画面構成図

```
┌─────────────────────────────────────────────────────────────────────┐
│  🏇 競馬賭けシミュレーションダッシュボード              [設定] [ヘルプ] │
├─────────────────────────────────────────────────────────────────────┤
│ ┌─────────────┐                                                     │
│ │ サイドバー   │  ┌───────────────────────────────────────────────┐ │
│ │             │  │                                               │ │
│ │ 📊 サマリー  │  │              メインコンテンツエリア            │ │
│ │ 📈 資金推移  │  │                                               │ │
│ │ 📉 リスク分析│  │                                               │ │
│ │ 🎯 的中分析  │  │                                               │ │
│ │ 🏇 条件別分析│  │                                               │ │
│ │ ⚖️ 戦略比較  │  │                                               │ │
│ │ 🎲 モンテカルロ│ │                                               │ │
│ │ ⚙️ 設定     │  │                                               │ │
│ │             │  └───────────────────────────────────────────────┘ │
│ └─────────────┘                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 6.2 各画面詳細設計

#### 6.2.1 サマリー画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📊 シミュレーションサマリー                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│ │  💰 最終資金  │ │  📈 ROI     │ │  📉 最大DD  │ │  🎯 的中率   │   │
│ │             │ │             │ │             │ │             │   │
│ │  ¥135,420   │ │  135.42%    │ │  18.5%      │ │  30.0%      │   │
│ │  (+35,420)  │ │     ↑       │ │     ↓       │ │  (156/520)  │   │
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘   │
│                                                                     │
│ ┌───────────────────────────────┐ ┌───────────────────────────────┐│
│ │    Go/No-Go判定               │ │    リスク指標                  ││
│ │                               │ │                               ││
│ │    ✅ GO                      │ │  破産確率:      2.3%          ││
│ │                               │ │  シャープレシオ: 1.45          ││
│ │    ✅ 破産確率 2.3% < 5%     │ │  VaR (95%):     ¥-15,000      ││
│ │    ✅ ROI 135.42% >= 150%    │ │  最大連敗:      12連敗         ││
│ │    ✅ 最大DD 18.5% < 50%     │ │                               ││
│ │                               │ │                               ││
│ └───────────────────────────────┘ └───────────────────────────────┘│
│                                                                     │
│ ┌───────────────────────────────────────────────────────────────┐  │
│ │  資金推移プレビュー                                            │  │
│ │  [小さなラインチャート]                                        │  │
│ └───────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

**Streamlitコード例:**

```python
import streamlit as st
import plotly.express as px

def render_summary_page(result: SimulationResult):
    st.header("📊 シミュレーションサマリー")
    
    # KPIカード
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric(
            label="💰 最終資金",
            value=f"¥{result.final_fund:,.0f}",
            delta=f"{result.final_fund - result.initial_fund:+,.0f}"
        )
    
    with col2:
        st.metric(
            label="📈 ROI",
            value=f"{result.metrics.roi:.1f}%",
            delta=f"{result.metrics.roi - 100:+.1f}%"
        )
    
    with col3:
        st.metric(
            label="📉 最大DD",
            value=f"{result.metrics.max_drawdown:.1f}%",
            delta=None,
            delta_color="inverse"
        )
    
    with col4:
        st.metric(
            label="🎯 的中率",
            value=f"{result.metrics.hit_rate:.1f}%",
            delta=f"{result.metrics.total_hits}/{result.metrics.total_bets}"
        )
    
    # Go/No-Go判定
    col1, col2 = st.columns(2)
    
    with col1:
        st.subheader("Go/No-Go判定")
        if result.go_decision.decision:
            st.success("✅ GO")
        else:
            st.error("⚠️ NO-GO")
        
        for reason in result.go_decision.go_reasons:
            st.write(f"✅ {reason}")
        for reason in result.go_decision.nogo_reasons:
            st.write(f"❌ {reason}")
    
    with col2:
        st.subheader("リスク指標")
        st.write(f"破産確率: {result.metrics.bankruptcy_prob:.1f}%")
        st.write(f"シャープレシオ: {result.metrics.sharpe_ratio:.2f}")
        st.write(f"VaR (95%): ¥{result.metrics.var_95:,.0f}")
        st.write(f"最大連敗: {result.metrics.max_consecutive_losses}連敗")
    
    # 資金推移プレビュー
    st.subheader("資金推移")
    fig = px.line(
        x=range(len(result.fund_history)),
        y=result.fund_history,
        labels={'x': 'レース', 'y': '資金（円）'}
    )
    st.plotly_chart(fig, use_container_width=True)
```

#### 6.2.2 資金推移画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📈 資金推移分析                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  [期間フィルタ: 全期間 ▼] [表示: 線形 ▼] [📥 エクスポート]      ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │                                                                 ││
│ │                     資金推移グラフ                               ││
│ │                                                                 ││
│ │   150k ┤                                              ╭────     ││
│ │        │                               ╭─────────────╯          ││
│ │   125k ┤              ╭───────────────╯                         ││
│ │        │         ╭────╯                                         ││
│ │   100k ┼────────╯                                               ││
│ │        │                                                        ││
│ │    75k ┤                                                        ││
│ │        └────────────────────────────────────────────────────    ││
│ │          1月     2月     3月     4月     5月     6月            ││
│ │                                                                 ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  月次サマリー                    │ │  統計情報                  │  │
│ │                                 │ │                           │  │
│ │  1月: +¥5,200 (105.2%)         │ │  最高資金: ¥142,300       │  │
│ │  2月: +¥8,400 (107.8%)         │ │  最低資金: ¥82,100        │  │
│ │  3月: -¥2,100 (98.1%)          │ │  平均資金: ¥115,400       │  │
│ │  4月: +¥12,300 (111.0%)        │ │  標準偏差: ¥12,340        │  │
│ │  5月: +¥7,800 (106.2%)         │ │                           │  │
│ │  6月: +¥3,820 (102.9%)         │ │                           │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.3 リスク分析画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📉 リスク分析                                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  ドローダウン推移                │ │  リスク指標ゲージ          │  │
│ │                                 │ │                           │  │
│ │  [ドローダウングラフ]           │ │  破産確率                  │  │
│ │                                 │ │  [====      ] 2.3%        │  │
│ │                                 │ │  （目標: 5%以下）          │  │
│ │                                 │ │                           │  │
│ │                                 │ │  最大DD                   │  │
│ │                                 │ │  [========  ] 18.5%       │  │
│ │                                 │ │  （目標: 50%以下）         │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  VaR/CVaR分析                   │ │  水中グラフ                │  │
│ │                                 │ │                           │  │
│ │  信頼水準: [95% ▼]             │ │  [ドローダウン期間の       │  │
│ │                                 │ │   可視化グラフ]            │  │
│ │  VaR:  ¥-15,000               │ │                           │  │
│ │  CVaR: ¥-22,300               │ │                           │  │
│ │                                 │ │                           │  │
│ │  [VaR分布グラフ]               │ │                           │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.4 的中分析画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🎯 的中分析                                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  的中率・回収率推移                                              ││
│ │  [移動平均線付きグラフ]                                          ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  連敗分布                        │ │  馬券種別成績              │  │
│ │                                 │ │                           │  │
│ │  [ヒストグラム]                 │ │  種別    的中率   回収率   │  │
│ │                                 │ │  単勝    28.5%   132.1%  │  │
│ │  最大連敗: 12                   │ │  複勝    45.2%   108.3%  │  │
│ │  平均連敗: 3.2                  │ │  馬連    15.3%   145.6%  │  │
│ │                                 │ │  ワイド  32.1%   112.4%  │  │
│ │                                 │ │  三連複   8.2%   178.9%  │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  オッズ別的中率                  │ │  配当分布                  │  │
│ │                                 │ │                           │  │
│ │  [横棒グラフ]                   │ │  [箱ひげ図]               │  │
│ │                                 │ │                           │  │
│ │  1-3倍:   42.3%                │ │                           │  │
│ │  3-5倍:   28.1%                │ │                           │  │
│ │  5-10倍:  15.6%                │ │                           │  │
│ │  10倍以上: 5.2%                │ │                           │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.5 条件別分析画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🏇 条件別分析                                                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  [競馬場別] [距離別] [芝/ダート別] [人気別] [穴馬確率別]          ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ 【競馬場別ROI】                                                      │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │                                                                 ││
│ │  東京  ████████████████████████ 152.3%                         ││
│ │  中山  ██████████████████████ 143.1%                           ││
│ │  阪神  ████████████████████ 138.5%                             ││
│ │  京都  ███████████████████ 132.4%                              ││
│ │  中京  ██████████████ 118.2%                                   ││
│ │  新潟  ████████████ 105.6%                                     ││
│ │  小倉  ████████ 92.3%                                          ││
│ │                                                                 ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌───────────────────────────────────────────────────────────────┐  │
│ │  条件別ヒートマップ                                            │  │
│ │                                                                │  │
│ │         短距離  中距離  長距離                                  │  │
│ │  東京芝   142%    158%    135%                                 │  │
│ │  中山芝   138%    145%    128%                                 │  │
│ │  東京ダ   125%    132%    -                                    │  │
│ │  ...                                                           │  │
│ └───────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.6 戦略比較画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ ⚖️ 戦略比較                                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  比較する戦略を選択:                                             ││
│ │  ☑ favorite_win  ☑ box_quinella  ☑ value_win  ☐ longshot_win   ││
│ │  [比較実行]                                                      ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  資金推移比較                                                    ││
│ │  [複数戦略の資金推移を重ねたラインチャート]                        ││
│ │                                                                 ││
│ │  ─── favorite_win   ─── box_quinella   ─── value_win           ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  リスクリターン散布図            │ │  戦略別指標比較            │  │
│ │                                 │ │                           │  │
│ │  [X軸: リスク、Y軸: リターン]   │ │  指標      fav   box  val │  │
│ │  [各戦略をプロット]             │ │  ROI     135%  142%  128% │  │
│ │                                 │ │  最大DD   18%   25%   15% │  │
│ │  理想的な位置:                  │ │  Sharpe  1.45  1.32  1.51 │  │
│ │  右上（高リターン・低リスク）   │ │  的中率   30%   22%   35% │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.7 モンテカルロ画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ 🎲 モンテカルロシミュレーション                                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  試行回数: [10000 ▼]  手法: [ブートストラップ ▼]  [実行]         ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  最終資金分布                                                    ││
│ │  [ヒストグラム + 信頼区間]                                       ││
│ │                                                                 ││
│ │  中央値: ¥135,420                                               ││
│ │  5%分位: ¥78,500  |  95%分位: ¥215,600                          ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  信頼区間付き資金推移            │ │  確率指標                  │  │
│ │                                 │ │                           │  │
│ │  [中央値の線 +                  │ │  破産確率:     2.3%       │  │
│ │   5-95%の帯]                   │ │  目標達成確率: 68.5%      │  │
│ │                                 │ │  期待到達日数: 245日      │  │
│ │                                 │ │                           │  │
│ │                                 │ │  [破産確率推移グラフ]     │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  シナリオ探索                                                    ││
│ │  [スライダーで任意のパーセンタイルのシナリオを表示]                ││
│ │                                                                 ││
│ │  パーセンタイル: [────────●───] 75%                              ││
│ │  このシナリオの最終資金: ¥158,200                                ││
│ └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

#### 6.2.8 設定画面

```
┌─────────────────────────────────────────────────────────────────────┐
│ ⚙️ 設定                                                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  入力データ                                                      ││
│ │  TSVファイル: [ファイルを選択...]  または  [📁 ドラッグ&ドロップ]  ││
│ │  現在: predictions_2025.tsv (1,234レース)                        ││
│ └─────────────────────────────────────────────────────────────────┘│
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  戦略設定                        │ │  資金管理設定              │  │
│ │                                 │ │                           │  │
│ │  戦略: [favorite_win ▼]        │ │  方式: [ケリー基準 ▼]     │  │
│ │                                 │ │                           │  │
│ │  パラメータ:                    │ │  Kelly %: [0.25]          │  │
│ │  予測上位: [1] 頭               │ │                           │  │
│ │  最小オッズ: [1.1]             │ │  1点上限: [¥5,000]        │  │
│ │  最大オッズ: [100.0]           │ │  1レース上限: [¥15,000]   │  │
│ │                                 │ │  1日上限: [¥50,000]       │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
│                                                                     │
│ ┌─────────────────────────────────┐ ┌───────────────────────────┐  │
│ │  レースフィルタ                  │ │  出力設定                  │  │
│ │                                 │ │                           │  │
│ │  最小頭数: [12]                 │ │  ☑ JSON出力               │  │
│ │  最小信頼度: [0.6]             │ │  ☑ CSV出力                │  │
│ │                                 │ │  ☑ グラフ生成             │  │
│ │  競馬場: [全て ▼]              │ │                           │  │
│ │  ☐ 新馬戦見送り                │ │  グラフ形式: [PNG ▼]      │  │
│ │  ☐ 荒天時見送り                │ │                           │  │
│ └─────────────────────────────────┘ └───────────────────────────┘  │
│                                                                     │
│ ┌─────────────────────────────────────────────────────────────────┐│
│ │  [💾 設定を保存]  [📂 設定を読込]  [🔄 デフォルトに戻す]          ││
│ └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

---

## 7. グラフ仕様（全39種）

### 7.1 資金推移系（5種）

| No | グラフ名 | 種類 | X軸 | Y軸 | 備考 |
|----|---------|------|-----|-----|------|
| 1 | 資金推移（単一） | 折れ線 | レース/日付 | 資金（円） | 初期資金の水平線付き |
| 2 | 資金推移（複数シナリオ） | 折れ線（複数） | レース/日付 | 資金（円） | 色分け凡例 |
| 3 | 資金推移（信頼区間） | 折れ線+帯 | レース/日付 | 資金（円） | 中央値+5-95%帯 |
| 4 | 資金推移（対数） | 折れ線 | レース/日付 | 資金（対数） | 複利効果の可視化 |
| 5 | 累積リターン | 折れ線 | レース/日付 | リターン（%） | 0%基準線付き |

### 7.2 リスク分析系（5種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 6 | ドローダウン推移 | 面グラフ | 下向きに描画、最大DD点をマーク |
| 7 | 最大ドローダウン分布 | ヒストグラム | モンテカルロ結果から |
| 8 | 水中グラフ | 面グラフ | ピーク未回復期間の可視化 |
| 9 | VaR/CVaR | 縦線+分布 | VaR/CVaRの位置を明示 |
| 10 | 破産確率推移 | 折れ線 | 時系列での破産確率変化 |

### 7.3 収益分析系（6種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 11 | 最終資金分布（ヒストグラム） | ヒストグラム | ビン幅自動調整 |
| 12 | 最終資金分布（箱ひげ図） | 箱ひげ図 | 中央値・四分位・外れ値 |
| 13 | ROI分布 | ヒストグラム | 100%基準線付き |
| 14 | 月次リターン | 棒グラフ | 正負で色分け |
| 15 | 年次リターン | 棒グラフ | 複数年比較 |
| 16 | 正規QQプロット | 散布図 | リターンの正規性検定 |

### 7.4 的中・馬券分析系（8種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 17 | 的中率推移 | 折れ線 | 移動平均付き |
| 18 | 回収率推移 | 折れ線 | 100%基準線付き |
| 19 | 連敗ヒストグラム | ヒストグラム | 連敗回数の分布 |
| 20 | 馬券種別収支 | 横棒グラフ | 種別ごとの損益 |
| 21 | 馬券種別的中率 | 横棒グラフ | 種別ごとの的中率 |
| 22 | オッズ別的中率 | 横棒グラフ | オッズ帯ごとの的中率 |
| 23 | 配当分布 | 箱ひげ図 | 馬券種別ごと |
| 24 | 的中間隔ヒストグラム | ヒストグラム | 的中までのレース数 |

### 7.5 条件別分析（7種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 25 | 競馬場別ROI | 横棒グラフ | ソート済み |
| 26 | 競馬場別収支 | 横棒グラフ | 金額ベース |
| 27 | 距離別ROI | 横棒グラフ | 距離帯ごと |
| 28 | 芝/ダート別ROI | 横棒グラフ | 2種比較 |
| 29 | 人気別的中率 | 横棒グラフ | 人気帯ごと |
| 30 | 穴馬確率別的中率 | 折れ線 | 確率帯ごと |
| 31 | 条件別ヒートマップ | ヒートマップ | 競馬場×距離等 |

### 7.6 戦略比較（4種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 32 | 戦略別資金推移 | 折れ線（複数） | 戦略ごとに色分け |
| 33 | リスクリターン散布図 | 散布図 | X: リスク、Y: リターン |
| 34 | シャープレシオ比較 | 横棒グラフ | 戦略ごと |
| 35 | パラメータ感度分析 | ヒートマップ/折れ線 | パラメータ変化の影響 |

### 7.7 Walk-Forward分析（3種）

| No | グラフ名 | 種類 | 説明 |
|----|---------|------|------|
| 36 | 期間別ROI推移 | 折れ線+棒 | 各期間のROI |
| 37 | 期間別ドローダウン | 棒グラフ | 各期間の最大DD |
| 38 | 学習期間感度 | 折れ線 | 学習期間長さの影響 |

### 7.8 インタラクティブHTML（3種）

| No | グラフ名 | 説明 |
|----|---------|------|
| 39-a | インタラクティブ資金推移 | ズーム・パン・ホバー対応 |
| 39-b | シナリオ探索ツール | スライダーでパーセンタイル選択 |
| 39-c | 条件別ダッシュボード | ドリルダウン対応 |

---

## 8. レスポンシブ対応

### 8.1 ブレークポイント

| サイズ | 幅 | レイアウト |
|--------|-----|----------|
| Desktop | 1200px+ | フル機能 |
| Tablet | 768px-1199px | サイドバー折りたたみ |
| Mobile | -767px | 非対応（デスクトップ推奨） |

### 8.2 Streamlit固有の対応

```python
# レイアウト設定
st.set_page_config(
    page_title="競馬賭けシミュレーション",
    page_icon="🏇",
    layout="wide",
    initial_sidebar_state="expanded"
)

# カスタムCSS
st.markdown("""
<style>
    /* メトリクスカードのスタイル */
    [data-testid="stMetricValue"] {
        font-size: 28px;
        font-weight: bold;
    }
    
    /* サイドバー幅 */
    [data-testid="stSidebar"] {
        min-width: 250px;
        max-width: 300px;
    }
    
    /* グラフコンテナ */
    .chart-container {
        background-color: white;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
</style>
""", unsafe_allow_html=True)
```

---

## 9. アクセシビリティ

### 9.1 対応項目

| 項目 | 対応 |
|------|------|
| 色覚多様性 | 色だけでなくパターン・アイコンを併用 |
| キーボード操作 | Tab移動、Enter実行 |
| スクリーンリーダー | alt属性、aria-label設定 |
| コントラスト比 | WCAG AA準拠（4.5:1以上） |

### 9.2 グラフの代替テキスト

```python
def generate_chart_alt_text(chart_type: str, data: dict) -> str:
    """グラフの代替テキストを生成"""
    if chart_type == "fund_history":
        return (
            f"資金推移グラフ。初期資金{data['initial']:,}円から"
            f"最終資金{data['final']:,}円へ推移。"
            f"最大ドローダウンは{data['max_dd']:.1f}%。"
        )
    # ...
```

---

**文書情報**
- 作成日: 2026-01-21
- バージョン: 1.0.0
- 関連文書: [TECHNICAL_DESIGN.md](./TECHNICAL_DESIGN.md), [API_INTERFACE.md](./API_INTERFACE.md)
