# 競馬賭けシミュレーター 操作説明書

## 目次

1. [はじめに](#はじめに)
2. [システムの起動](#システムの起動)
3. [画面構成](#画面構成)
4. [基本操作](#基本操作)
5. [各ページの使い方](#各ページの使い方)
6. [設定項目の詳細](#設定項目の詳細)
7. [実運用を見越したシミュレーション手順](#実運用を見越したシミュレーション手順)
8. [トラブルシューティング](#トラブルシューティング)
9. [よくある質問（FAQ）](#よくある質問faq)

---

## はじめに

本システムは、競馬の賭け戦略をシミュレーションするためのツールです。  
過去のレースデータを使って、様々な戦略・資金管理方式の有効性を検証できます。

### このシステムでできること

| 機能 | 説明 |
|------|------|
| 📊 シミュレーション | 過去データを使った戦略検証 |
| 💰 資金推移分析 | 資金がどのように変動するか可視化 |
| 📈 収益分析 | ROI、的中率、オッズ帯別成績など |
| ⚠️ リスク分析 | ドローダウン、連敗、破産確率の評価 |
| 🔄 戦略比較 | 複数戦略を同時実行して比較 |
| ⚙️ パラメータ調整 | 戦略・資金管理の細かいチューニング |

### 対象ユーザー

- 自作の予測モデルを持っている方
- 賭け戦略の有効性を検証したい方
- 資金管理の重要性を理解したい方
- 実運用前にリスクを把握したい方

### 前提条件

- 予測結果がTSV形式で出力されていること
- 各馬に予測順位（`predicted_rank`）が付与されていること
- 過去のオッズ・着順データが含まれていること

---

## システムの起動

### 方法1: Run.batを使用（推奨）

1. `Run.bat` をダブルクリック
2. コマンドプロンプトが開き、サーバーが起動
3. 自動的にブラウザで `http://localhost:8501` が開く
4. 開かない場合は手動でブラウザからアクセス

> **Note**: 初回起動時は依存パッケージの読み込みで数秒かかることがあります。

### 方法2: コマンドラインから起動

```bash
# プロジェクトディレクトリに移動
cd d:/src/Python/KirisameBettingSimulation

# 仮想環境を有効化
venv\Scripts\activate

# Streamlitを起動
python -m streamlit run src/betting_simulation/dashboard/app.py --server.port 8501
```

### 方法3: CLIコマンドを使用

```bash
betting-sim dashboard
```

### 起動オプション

| オプション | 説明 | 例 |
|-----------|------|-----|
| `--server.port` | ポート番号を変更 | `--server.port 8080` |
| `--server.headless` | ブラウザを自動で開かない | `--server.headless true` |
| `--theme.base` | テーマを変更 | `--theme.base dark` |

---

## 画面構成

### サイドバー（左側）

```
┌─────────────────────────────┐
│  🏇 競馬シミュレーター       │
│                             │
│  ○ 📊 サマリー              │  ← ページ選択
│  ○ 💰 資金推移              │
│  ○ 📈 収益分析              │
│  ○ ⚠️ リスク分析            │
│  ○ 🔄 戦略比較              │
│  ○ ⚙️ 設定                  │
│                             │
│  ─────────────────          │
│                             │
│  📁 データ読み込み           │  ← TSVファイルアップロード
│  [Browse files]             │
│  [データ読み込み]            │
│                             │
│  📊 1234レース読み込み済み   │  ← ステータス表示
└─────────────────────────────┘
```

### メインエリア（右側）

選択したページの内容が表示されます。各ページは以下の構成です：

- **ヘッダー**: ページタイトルと概要
- **メトリクス**: 主要な数値指標（KPI）
- **グラフ・チャート**: データの可視化
- **詳細テーブル**: 生データの確認

---

## 基本操作

### Step 1: データの読み込み

#### 操作手順

1. サイドバーの「📁 データ読み込み」セクションを探す
2. 「Browse files」ボタンをクリック
3. 予測結果のTSVファイルを選択
4. 「データ読み込み」ボタンをクリック
5. 「✅ ○○レース読み込み完了」と表示されれば成功

#### TSVファイルの必須カラム

| カラム名 | 型 | 説明 | 例 |
|---------|-----|------|-----|
| `race_id` | string | レース識別子 | `202501010101` |
| `kaisai_date` | string | 開催日 | `2025-01-01` |
| `track` | string | 競馬場名 | `東京` |
| `race_number` | int | レース番号 | `11` |
| `horse_number` | int | 馬番 | `5` |
| `horse_name` | string | 馬名 | `ディープインパクト` |
| `odds` | float | 単勝オッズ | `2.5` |
| `result_rank` | int | 着順 | `1` |
| `predicted_rank` | int | 予測順位 | `1` |
| `predicted_score` | float | 予測スコア | `0.85` |

#### オプションカラム（あれば分析精度向上）

| カラム名 | 型 | 説明 |
|---------|-----|------|
| `quinella_payouts` | string | 馬連払戻（JSON形式） |
| `wide_payouts` | string | ワイド払戻（JSON形式） |
| `trio_payouts` | float | 三連複払戻 |
| `hole_probability` | float | 穴馬確率（0-1） |

> **Note**: 一度読み込んだデータはキャッシュされ、ブラウザを閉じても保持されます。再読み込みしたい場合は新しいファイルをアップロードしてください。

### Step 2: シミュレーション設定

#### 操作手順

1. サイドバーで「⚙️ 設定」を選択
2. 「🎮 シミュレーション設定」タブを開く
3. 基本設定を行う:

| 設定項目 | 推奨値 | 説明 |
|---------|--------|------|
| 初期資金 | 100,000円 | 実際の運用資金に合わせる |
| 破産ライン | 10-30% | 低いほど早く停止 |

4. 戦略を選択:
   - ドロップダウンから戦略を選択
   - 表示されるパラメータを調整

5. 資金管理方式を選択:
   - 定額方式: 一定額を賭け続ける
   - 定率方式: 資金の一定割合を賭ける
   - ケリー基準: 期待値に基づいて賭け金を最適化

### Step 3: シミュレーション実行

1. 設定ページ下部の「🚀 シミュレーション実行」ボタンをクリック
2. 実行中はスピナーが表示される
3. 完了後、以下が表示される:
   - 最終資金
   - ROI
   - 的中率
   - 利益

### Step 4: 結果の分析

各ページで詳細な分析結果を確認:

1. **📊 サマリー**: 結果の概要と賭け履歴
2. **💰 資金推移**: 資金の変動パターン
3. **📈 収益分析**: 収益性の詳細
4. **⚠️ リスク分析**: リスク指標の確認

---

## 各ページの使い方

### 📊 サマリー

シミュレーション結果の概要を表示します。

#### 主要メトリクス

| 指標 | 説明 | 良い値の目安 |
|------|------|-------------|
| 最終資金 | シミュレーション終了時の資金 | 初期資金以上 |
| ROI | 投資利益率 | 100%以上（プラス収支） |
| 的中率 | 賭けが的中した割合 | 戦略による |
| 総賭け数 | 実行した賭けの総数 | - |
| 的中数 | 的中した賭けの数 | - |

#### 資金推移グラフの見方

- **緑色上昇**: 利益が出ている期間
- **赤色下降**: 損失が出ている期間
- **横ばい**: 賭けなし or 損益ゼロ

#### 賭け履歴テーブル

最新の賭け結果を表示します。

| カラム | 説明 |
|--------|------|
| 日付 | 賭けた日（yyyy/MM/dd形式） |
| 競馬場 | 開催競馬場 |
| R | レース番号 |
| 馬券種 | 単勝/複勝/馬連/ワイド/三連複 |
| 馬番 | 購入した馬番の組み合わせ |
| 馬名 | 対象馬の名前 |
| 賭け金 | 投入金額 |
| 払戻 | 的中時の払戻金（0=ハズレ） |
| 損益 | 払戻 - 賭け金 |

ページネーション機能で過去の履歴も確認可能です。

---

### 💰 資金推移

資金の変動を詳細に分析します。

#### 📈 資金推移タブ

**基本グラフ**
- X軸: 時間（レース順）
- Y軸: 資金額
- 初期資金からの増減がわかる

**オプション機能**（チェックボックスで有効化）

| オプション | 説明 |
|-----------|------|
| 移動平均を表示 | 短期的なノイズを除去してトレンドを可視化 |
| 目標ラインを表示 | 目標資金額を水平線で表示 |
| ドローダウン推移 | 最高値からの下落率を表示 |

#### 📊 日別分析タブ

**日別損益グラフ**
- 棒グラフで日ごとの損益を表示
- 緑: プラス、赤: マイナス

**日別詳細テーブル**

| カラム | 説明 |
|--------|------|
| 日付 | 開催日 |
| 賭け数 | その日の総賭け数 |
| 的中数 | 的中した賭けの数 |
| 投資額 | 投入した総額 |
| 回収額 | 払い戻された総額 |
| 損益 | 回収額 - 投資額 |
| 回収率 | 回収額 / 投資額 × 100 |

#### 🔥 ヒートマップタブ

**競馬場×月別ヒートマップ**
- 色が濃いほど損益が大きい
- 得意・不得意な競馬場がわかる

**活用例**
- 特定の競馬場で勝率が高い → その場を重点的に
- 特定の月に負けやすい → その時期は控えめに

---

### 📈 収益分析

収益性を多角的に分析します。

#### 累積利益グラフ

- 時系列での利益の積み上げ
- 右肩上がり = 安定した収益
- 上下動が激しい = ボラティリティが高い

#### ROI推移

- レースごとのROI（累積）を表示
- 安定して100%以上なら良い戦略

#### オッズ帯別成績

| オッズ帯 | 分析ポイント |
|---------|-------------|
| 1.0-2.0倍 | 本命馬。的中率は高いがリターンは低い |
| 2.0-5.0倍 | 中穴。バランスの良いゾーン |
| 5.0-10.0倍 | 穴馬。的中率は低いがリターンは大きい |
| 10.0倍以上 | 大穴。ハイリスク・ハイリターン |

**見るべきポイント**
- どのオッズ帯で利益が出ているか
- 期待値がプラスのゾーンはどこか

#### 馬券種別成績

各馬券種ごとの成績を比較:
- 単勝 / 複勝 / 馬連 / ワイド / 三連複

---

### ⚠️ リスク分析

リスク指標を確認し、戦略の安全性を評価します。

#### ドローダウン分析

**ドローダウンとは**
資金が最高値からどれだけ下落したかを示す指標。

```
最大ドローダウン = (最高資金 - 最低資金) / 最高資金 × 100%
```

| 最大DD | 評価 | 説明 |
|--------|------|------|
| 10%未満 | 優秀 | 非常に安定した戦略 |
| 10-20% | 良好 | 許容範囲内 |
| 20-30% | 注意 | 資金管理の見直しを検討 |
| 30%以上 | 危険 | 破産リスクが高い |

#### 連敗分析

**最大連敗数**
- 連続して負けた最大回数
- 長いほど精神的負担が大きい

**連敗時の損失額**
- 連敗中にどれだけ資金が減ったか
- 資金管理の重要性がわかる

#### ボラティリティ分析

**標準偏差**
- 損益のばらつき
- 大きいほどリスクが高い

**シャープレシオ**
```
シャープレシオ = 平均リターン / 標準偏差
```
- 1.0以上: 優秀
- 0.5-1.0: 普通
- 0.5未満: リスクに見合わない

---

### 🔄 戦略比較

複数の戦略を同時実行して比較します。

#### 使い方

1. 比較したい戦略をチェックボックスで選択
2. 「比較実行」ボタンをクリック
3. 結果が並べて表示される

#### 比較テーブルの見方

| 戦略 | 最終資金 | ROI | 的中率 | 最大DD |
|------|---------|-----|--------|--------|
| A戦略 | 120,000 | 120% | 35% | 15% |
| B戦略 | 95,000 | 95% | 28% | 25% |

#### 判断のポイント

- **ROIだけで判断しない**: 高ROIでも最大DDが大きいと危険
- **的中率とのバランス**: 的中率が低すぎると精神的に継続困難
- **安定性を重視**: 長期運用ではドローダウンの小ささが重要

---

### ⚙️ 設定

シミュレーション設定と結果のエクスポートを行います。

#### 🎮 シミュレーション設定タブ

**基本設定**

| 項目 | 説明 | 推奨範囲 |
|------|------|---------|
| 初期資金 | 開始時の資金 | 実運用予定額 |
| 破産ライン | この%を下回ったら終了 | 10-30% |

**戦略設定**

ドロップダウンから選択し、パラメータを調整。

**資金管理設定**

| 方式 | パラメータ | 説明 |
|------|-----------|------|
| 定額方式 | 賭け金額 | 毎回同じ金額を賭ける |
| 定率方式 | 資金割合 | 現在資金の〇%を賭ける |
| ケリー基準 | 係数・上限 | 期待値に基づく最適賭け |

#### 📤 エクスポートタブ

結果をファイルとして保存:

| 形式 | 用途 |
|------|------|
| JSON | プログラムでの再利用 |
| CSV | Excelでの分析 |

#### 📝 設定ファイルタブ

YAML形式で設定を保存・読み込み:

```yaml
initial_fund: 100000
bankruptcy_ratio: 0.1
strategy_name: favorite_win
strategy_params:
  top_n: 1
  min_odds: 1.5
fund_manager_name: fixed
fund_manager_params:
  bet_amount: 1000
```

---

## 設定項目の詳細

### 戦略一覧

#### 単勝系戦略

| 戦略名 | 説明 | パラメータ |
|--------|------|-----------|
| **予測上位N頭の単勝を購入** | 予測順位上位の馬の単勝を購入 | `top_n`: 上位何頭まで買うか（1-5）<br>`min_odds`: 最低オッズ（これ未満は除外）<br>`max_odds`: 最高オッズ（これ超過は除外） |
| **期待値ベース単勝** | 期待値が閾値以上の馬を購入 | `min_expected_value`: 最低期待値（1.0以上推奨）<br>`max_tickets`: 最大購入数 |
| **穴馬単勝** | 穴馬確率が高い馬を購入 | `min_hole_probability`: 最低穴馬確率<br>`max_tickets`: 最大購入数<br>`min_odds`: 最低オッズ |

#### 複勝系戦略

| 戦略名 | 説明 | パラメータ |
|--------|------|-----------|
| **予測上位N頭の複勝を購入** | 予測順位上位の馬の複勝を購入 | `top_n`: 上位何頭まで買うか |

#### 馬連系戦略

| 戦略名 | 説明 | パラメータ |
|--------|------|-----------|
| **馬連ボックス** | 上位N頭の全組み合わせ | `box_size`: ボックスに含める頭数（2-5）<br>※買い目点数 = nC2 |
| **馬連流し** | 軸馬から相手馬へ流し | `num_axis`: 軸馬数（1-3）<br>`num_partners`: 相手馬数（2-10） |
| **馬連ホイール** | 軸馬から全頭へ | `num_axis`: 軸馬数<br>`exclude_low_odds`: 除外する低オッズ馬数 |

#### ワイド系戦略

| 戦略名 | 説明 | パラメータ |
|--------|------|-----------|
| **ワイドボックス** | 上位N頭の全組み合わせ | `box_size`: ボックスに含める頭数（2-5） |

#### 三連複系戦略

| 戦略名 | 説明 | パラメータ |
|--------|------|-----------|
| **三連複ボックス** | 上位N頭の全組み合わせ | `box_size`: ボックスに含める頭数（3-6）<br>※買い目点数 = nC3 |
| **三連複流し** | 1頭軸から相手馬へ | `num_partners`: 相手馬数（3-10） |
| **三連複フォーメーション** | 列ごとに頭数を指定 | `first_n`: 1列目の頭数<br>`second_n`: 2列目の頭数<br>`third_n`: 3列目の頭数 |

### 資金管理方式一覧

#### 定額方式（fixed）

**概要**: 毎回同じ金額を賭ける最もシンプルな方式

| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| `bet_amount` | 1回あたりの賭け金 | 初期資金の1-2% |

**メリット**
- シンプルで管理しやすい
- 損失の上限が明確

**デメリット**
- 勝っても賭け金が増えない
- 資金効率が悪い

#### 定率方式（percentage）

**概要**: 現在資金の一定割合を賭ける

| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| `percentage` | 資金に対する割合 | 1-5% |

**例**: 資金10万円、割合2%の場合
- 賭け金 = 100,000 × 0.02 = 2,000円
- 資金が12万円に増えたら → 2,400円
- 資金が8万円に減ったら → 1,600円

**メリット**
- 勝てば賭け金が増える（複利効果）
- 負けると賭け金が減る（破産防止）

**デメリット**
- 連敗時に賭け金が小さくなりすぎる

#### ケリー基準（kelly）

**概要**: 期待値に基づいて数学的に最適な賭け金を計算

| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| `fraction` | ケリー係数（1.0=フルケリー） | 0.25-0.5 |
| `max_bet_ratio` | 最大賭け率（上限） | 0.05-0.10 |

**計算式**
```
賭け率 = (p × b - q) / b × fraction

p = 勝率（予測）
q = 1 - p（負ける確率）
b = オッズ - 1
fraction = ケリー係数
```

**メリット**
- 理論上、長期的に資金を最大化
- 期待値の高い賭けに多く投入

**デメリット**
- 予測精度に依存
- フルケリーは変動が激しい

**推奨**: ハーフケリー（fraction=0.5）以下で運用

---

## 実運用を見越したシミュレーション手順

実際に競馬で運用することを想定した、本格的なシミュレーション手順を解説します。

### Phase 1: データ準備と基本検証

#### Step 1.1: 十分なデータ量を確保

| 最低データ量 | 推奨データ量 | 理想データ量 |
|-------------|-------------|-------------|
| 100レース | 500レース | 1000レース以上 |

**なぜ多くのデータが必要か**
- 少ないデータでは偶然の結果に左右される
- 統計的に有意な結果を得るには最低500レース推奨
- 季節変動を考慮するなら1年分（約3000レース）

#### Step 1.2: データの期間を確認

```
良い例: 2024年1月〜2025年12月（2年分）
悪い例: 2025年6月のみ（1ヶ月分）
```

- 特定の時期だけだと、その時期特有の傾向に過学習
- 複数年のデータで季節性を確認

#### Step 1.3: 予測モデルの精度を確認

シミュレーション前に予測精度をチェック:

| 指標 | 目安 | 確認方法 |
|------|------|---------|
| 予測1位の勝率 | 30%以上 | 予測1位馬が実際に1着になった割合 |
| 予測上位3頭の3着内率 | 60%以上 | 予測上位3頭が3着以内に入った割合 |
| 相関係数 | 0.3以上 | 予測順位と実際の着順の相関 |

---

### Phase 2: 戦略の絞り込み

#### Step 2.1: 複数戦略で初期テスト

「🔄 戦略比較」ページで、以下の戦略を同時に実行:

1. 予測上位1頭の単勝（最もシンプル）
2. 予測上位2頭の単勝
3. 馬連ボックス3頭
4. ワイドボックス3頭

#### Step 2.2: 結果を評価

以下の観点で戦略を評価:

| 評価項目 | 重要度 | 判断基準 |
|---------|--------|---------|
| ROI | ★★★★★ | 100%以上が必須 |
| 最大ドローダウン | ★★★★☆ | 30%未満が望ましい |
| 的中率 | ★★★☆☆ | 継続できる水準か |
| シャープレシオ | ★★★☆☆ | 0.5以上が望ましい |

#### Step 2.3: 有望な戦略を2-3個に絞る

- ROI 100%以上
- 最大DD 30%未満
- 的中率が精神的に許容できる範囲

---

### Phase 3: パラメータ最適化

#### Step 3.1: パラメータを変えてテスト

例：「予測上位N頭の単勝」戦略

| パラメータ | テストする値 |
|-----------|-------------|
| top_n | 1, 2, 3 |
| min_odds | 1.5, 2.0, 2.5, 3.0 |
| max_odds | 10.0, 20.0, 50.0, 999.0 |

#### Step 3.2: 結果を記録

| top_n | min_odds | ROI | 的中率 | 最大DD |
|-------|----------|-----|--------|--------|
| 1 | 1.5 | 105% | 32% | 18% |
| 1 | 2.0 | 108% | 28% | 22% |
| 2 | 1.5 | 98% | 45% | 12% |
| 2 | 2.0 | 102% | 38% | 15% |

#### Step 3.3: 最適パラメータを選定

- 最高ROIではなく、**安定性とのバランス**で選ぶ
- 過学習に注意：極端なパラメータは避ける

---

### Phase 4: 資金管理の検証

#### Step 4.1: 資金管理方式を比較

同じ戦略で、資金管理だけ変えてテスト:

| 資金管理 | ROI | 最大DD | 最終資金 |
|---------|-----|--------|---------|
| 定額1000円 | 105% | 15% | 115,000 |
| 定率2% | 112% | 18% | 128,000 |
| ケリー0.5 | 125% | 28% | 145,000 |

#### Step 4.2: リスク許容度に合わせて選択

| タイプ | 推奨方式 | 理由 |
|--------|---------|------|
| 安定志向 | 定額方式 | 変動が小さく精神的に楽 |
| バランス型 | 定率方式 | 複利効果と安全性の両立 |
| 攻撃型 | ケリー基準 | 最大リターンを追求 |

---

### Phase 5: ロバスト性の検証

#### Step 5.1: 期間を分けてテスト

データを期間で分割:

| 期間 | 用途 |
|------|------|
| 2024年1月〜6月 | 訓練期間（パラメータ決定） |
| 2024年7月〜12月 | 検証期間（戦略の有効性確認） |
| 2025年1月〜現在 | テスト期間（最終確認） |

#### Step 5.2: 全期間で安定しているか確認

```
訓練期間: ROI 108%
検証期間: ROI 95%  ← 大きく下がっていたら注意
テスト期間: ROI 102%
```

- 期間によって大きく変わる → 過学習の可能性
- 全期間で安定 → 実運用に耐えうる

#### Step 5.3: 競馬場別の成績を確認

「💰 資金推移」→「🔥 ヒートマップ」で確認:

- 特定の競馬場だけで勝っている → 汎用性に疑問
- 全競馬場でプラス → 安心

---

### Phase 6: 実運用シミュレーション

#### Step 6.1: 実際の運用資金でテスト

実運用予定の資金額を設定:

| 項目 | 設定例 |
|------|--------|
| 初期資金 | 50,000円（実際に投入予定の額） |
| 破産ライン | 20%（10,000円を下回ったら撤退） |

#### Step 6.2: 月間の収支を確認

「💰 資金推移」→「📊 日別分析」で月単位の集計:

| 月 | 投資額 | 回収額 | 損益 | 累計 |
|----|--------|--------|------|------|
| 1月 | 15,000 | 18,000 | +3,000 | +3,000 |
| 2月 | 12,000 | 10,000 | -2,000 | +1,000 |
| 3月 | 18,000 | 22,000 | +4,000 | +5,000 |

#### Step 6.3: 最悪のシナリオを想定

「⚠️ リスク分析」で確認:

| 指標 | 値 | 対策 |
|------|-----|------|
| 最大ドローダウン | 25% | この下落に耐えられるか |
| 最大連敗 | 12連敗 | 精神的に耐えられるか |
| 破産確率 | 5% | 許容できるか |

---

### Phase 7: 運用ルールの策定

#### Step 7.1: 損切りルールを決める

```
例：初期資金の30%を失ったら一旦撤退
    → 50,000円 × 30% = 15,000円損失で停止
    → 残金35,000円になったら戦略見直し
```

#### Step 7.2: 利確ルールを決める

```
例：初期資金の50%の利益が出たら半分出金
    → 75,000円に達したら25,000円を出金
    → 残り50,000円で継続
```

#### Step 7.3: 見直しタイミングを決める

| 条件 | アクション |
|------|-----------|
| 月間で10%以上のマイナス | パラメータ見直し |
| 3ヶ月連続でマイナス | 戦略自体を見直し |
| 新しいデータが追加 | 再シミュレーション |

---

### 実運用チェックリスト

実際に運用を始める前に、以下を確認:

- [ ] 500レース以上でシミュレーション済み
- [ ] ROI 100%以上を達成
- [ ] 最大ドローダウン 30%未満
- [ ] 複数期間で安定した成績
- [ ] 実運用資金でのシミュレーション済み
- [ ] 損切り/利確ルールを決定済み
- [ ] 最悪のシナリオを想定済み
- [ ] 精神的に耐えられる的中率か確認済み

---

## トラブルシューティング

### データ関連

#### Q: データが読み込めない

**原因と対策**

| 原因 | 対策 |
|------|------|
| ファイル形式が違う | TSV形式（タブ区切り）であることを確認 |
| 必須カラムがない | `race_id`, `horse_number`, `odds`等を確認 |
| 文字コードが違う | UTF-8で保存し直す |
| ファイルが壊れている | 元ファイルから再出力 |

#### Q: 一部のレースしか読み込まれない

**原因と対策**

- 予測順位（`predicted_rank`）が重複しているレースは自動的にスキップされる
- 必須データが欠損しているレースもスキップされる

確認方法:
```
読み込み前のレース数と読み込み後の数を比較
→ 差分が除外されたレース数
```

---

### シミュレーション関連

#### Q: シミュレーションがすぐに終了する

**原因と対策**

| 原因 | 対策 |
|------|------|
| 破産ラインを割った | 破産ラインを下げる or 初期資金を増やす |
| 賭け金が大きすぎる | 資金管理の設定を見直す |
| オッズフィルターが厳しすぎる | min_odds, max_oddsを緩める |

#### Q: 賭けが一つも実行されない

**原因と対策**

- 戦略のパラメータが厳しすぎる
  - 例: `min_odds: 10.0` だと対象馬が少なすぎる
- 予測データに問題がある
  - `predicted_rank`が正しく設定されているか確認

#### Q: 払戻金が0になる

**原因と対策**

- 払戻データ（`quinella_payouts`等）がTSVに含まれていない
- オッズデータが正しくない
- データ形式が仕様と異なる

---

### 表示関連

#### Q: グラフが表示されない

**原因と対策**

| 原因 | 対策 |
|------|------|
| データがない | シミュレーションを先に実行 |
| ブラウザのキャッシュ | 強制リロード（Ctrl+Shift+R） |
| JavaScriptエラー | 開発者ツールでエラー確認 |

#### Q: ページが固まる

**原因と対策**

- データ量が多すぎる → ページネーションを使用
- ブラウザのメモリ不足 → 再起動

---

### 起動関連

#### Q: Run.batで起動しない

**確認事項**

1. venv環境にStreamlitがインストールされているか
   ```bash
   venv\Scripts\pip list | findstr streamlit
   ```

2. インストールされていなければ:
   ```bash
   venv\Scripts\pip install streamlit
   ```

3. Pythonのバージョン確認:
   ```bash
   venv\Scripts\python --version
   ```
   → 3.9以上が必要

#### Q: ポートが使用中と表示される

**対策**

1. 別のポートで起動:
   ```bash
   streamlit run app.py --server.port 8502
   ```

2. 使用中のプロセスを終了:
   ```bash
   netstat -ano | findstr :8501
   taskkill /PID <プロセスID> /F
   ```

---

## よくある質問（FAQ）

### 基本的な質問

#### Q: このシステムで本当に勝てるの？

**A**: このシステムは「戦略の検証ツール」です。勝てるかどうかは:
- 予測モデルの精度
- 選択する戦略
- 資金管理の適切さ
- 市場の状況

に依存します。シミュレーションで良い結果が出ても、将来を保証するものではありません。

#### Q: どの戦略がおすすめ？

**A**: 一概には言えませんが、初心者には:
- **予測上位1頭の単勝**（シンプルで分かりやすい）
- **定額方式**（資金管理がシンプル）

から始めることをお勧めします。

#### Q: 的中率が低くても大丈夫？

**A**: 的中率よりも**ROI**が重要です。

例:
- 的中率50%、平均配当1.8倍 → ROI 90%（負ける）
- 的中率20%、平均配当6.0倍 → ROI 120%（勝てる）

ただし、低的中率は精神的負担が大きいので、自分に合った水準を選んでください。

---

### 技術的な質問

#### Q: 予測順位の重複がスキップされるのはなぜ？

**A**: 予測順位が同じ馬が複数いると、「上位N頭」の選定が曖昧になるためです。

例: 予測1位が2頭いる場合
- どちらを「上位1頭」とするか決められない
- 公平性のためそのレースは除外

#### Q: ケリー基準の係数はどう決める？

**A**: 
- **フルケリー（1.0）**: 理論上最適だが変動が激しい
- **ハーフケリー（0.5）**: 実用的でバランスが良い
- **クォーターケリー（0.25）**: 保守的で安定志向

予測精度に自信がない場合は低めの係数を推奨。

#### Q: 三連複の買い目点数が多すぎる

**A**: ボックスの頭数を減らすか、フォーメーションを使用してください。

| 頭数 | ボックス点数 | フォーメーション例 |
|------|-------------|------------------|
| 5頭 | 10点 | 1-2-5 → 6点 |
| 6頭 | 20点 | 2-3-6 → 15点 |

---

## バージョン情報

- **バージョン**: 0.1.0
- **フェーズ**: Phase 4 Dashboard
- **最終更新日**: 2026年1月25日

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026/01/25 | 0.1.0 | 実運用手順、詳細設定項目を追加 |
| 2026/01/21 | 0.0.1 | 初版作成 |

---

## お問い合わせ

不明点や要望がありましたら、GitHubのIssuesでお知らせください。
