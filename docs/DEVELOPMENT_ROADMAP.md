# 開発ロードマップ（Development Roadmap）

## 概要

本ドキュメントは、競馬賭けシミュレーションシステムの開発計画を定義する。
全5フェーズ、約12週間の開発期間を想定。

---

## 開発タイムライン

```
Week 1-2    Week 3-4    Week 5-6    Week 7-8    Week 9-10   Week 11-12
   │           │           │           │           │           │
   ▼           ▼           ▼           ▼           ▼           ▼
┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐
│Phase1│   │Phase2│   │Phase3│   │Phase4│   │Phase5│   │ 安定 │
│ コア │ → │ 拡張 │ → │ 可視 │ → │ ダッシュ│ → │ 最適 │ → │ 化  │
│ 機能 │   │ 機能 │   │ 化  │   │ ボード │   │ 化  │   │     │
└──────┘   └──────┘   └──────┘   └──────┘   └──────┘   └──────┘
   MVP        α版       β版      RC版     v1.0.0    v1.0.x
```

---

## Phase 1: コア機能実装（Week 1-2）

### 目標
- 最小限の動作するシミュレーションシステム（MVP）
- CLIからシンプルシミュレーションが実行可能

### タスク一覧

| ID | タスク | 優先度 | 工数 | 依存 |
|----|--------|-------|------|------|
| 1.1 | プロジェクト構造セットアップ | 高 | 2h | - |
| 1.2 | データモデル実装（dataclasses） | 高 | 4h | 1.1 |
| 1.3 | DataLoader実装 | 高 | 6h | 1.2 |
| 1.4 | RaceFilter実装 | 高 | 4h | 1.2 |
| 1.5 | 基本戦略3種実装 | 高 | 8h | 1.2 |
| 1.6 | FundManager実装（Fixed） | 高 | 4h | 1.2 |
| 1.7 | BetEvaluator実装 | 高 | 6h | 1.2 |
| 1.8 | SimulationEngine実装 | 高 | 8h | 1.3-1.7 |
| 1.9 | MetricsCalculator実装 | 高 | 6h | 1.8 |
| 1.10 | CLI基本コマンド実装 | 高 | 4h | 1.8 |
| 1.11 | 設定ファイル読込（YAML） | 高 | 4h | 1.1 |
| 1.12 | ユニットテスト（コア） | 高 | 8h | 1.3-1.9 |

### 成果物
- `src/betting_simulation/` 基本パッケージ
- `betting-sim run` コマンド動作
- 基本テストスイート（カバレッジ 70%+）

### マイルストーン判定基準
- [x] TSVファイルを読み込める
- [x] 予測1位単勝戦略でシミュレーション実行可能
- [x] ROI、的中率が計算される
- [x] CLI `run` コマンドが動作

**Phase 1 完了: 2026-01-21** ✅

---

## Phase 2: 拡張機能実装（Week 3-4）

### 目標
- 全13種以上の賭け戦略を実装
- 3種の資金管理方式（Fixed, Percentage, Kelly）
- モンテカルロシミュレーション対応

### タスク一覧

| ID | タスク | 優先度 | 工数 | 依存 |
|----|--------|-------|------|------|
| 2.1 | 単勝戦略追加（Top-N、Value） | 高 | 4h | Phase1 |
| 2.2 | 複勝戦略実装 | 高 | 4h | Phase1 |
| 2.3 | 馬連戦略実装（BOX、Flow、Wheel） | 高 | 8h | Phase1 |
| 2.4 | ワイド戦略実装 | 中 | 4h | Phase1 |
| 2.5 | 三連複戦略実装 | 中 | 6h | Phase1 |
| 2.6 | Percentage資金管理実装 | 高 | 4h | Phase1 |
| 2.7 | Kelly基準資金管理実装 | 高 | 6h | Phase1 |
| 2.8 | モンテカルロエンジン実装 | 高 | 8h | Phase1 |
| 2.9 | Walk-Forwardエンジン実装 | 中 | 6h | 2.8 |
| 2.10 | 戦略比較機能実装 | 中 | 4h | 2.1-2.5 |
| 2.11 | CLI `compare` コマンド | 中 | 4h | 2.10 |
| 2.12 | ユニットテスト（拡張） | 高 | 8h | 2.1-2.9 |
| 2.13 | 統合テスト | 高 | 6h | 2.1-2.10 |

### 成果物
- 全戦略実装完了
- 3種の資金管理方式
- モンテカルロ・Walk-Forward対応
- `compare` コマンド

### マイルストーン判定基準
- [x] 13種以上の戦略が選択可能
- [x] ケリー基準で賭け金が動的計算される
- [x] 10,000試行のモンテカルロが60秒以内で完了
- [x] 複数戦略の比較レポートが出力される

**Phase 2 完了: 2026-01-21** ✅

### 実装済み戦略（13種）
1. favorite_win - 予測1位単勝
2. popularity_win - 人気順単勝
3. value_win - 期待値ベース単勝
4. favorite_place - 予測上位複勝
5. box_quinella - ボックス馬連
6. flow_quinella - 流し馬連
7. wheel_quinella - ホイール馬連
8. box_wide - ボックスワイド
9. box_trio - ボックス三連複
10. flow_trio - 流し三連複
11. formation_trio - フォーメーション三連複
12. hole_win - 穴馬単勝
13. hole_place - 穴馬複勝

---

## Phase 3: 可視化機能実装（Week 5-6）

### 目標
- 39種のグラフ・チャート生成
- Jupyter Notebook対応
- レポート出力機能

### タスク一覧

| ID | タスク | 優先度 | 工数 | 依存 |
|----|--------|-------|------|------|
| 3.1 | ChartGenerator基盤実装 | 高 | 4h | Phase2 |
| 3.2 | 資金推移グラフ（6種） | 高 | 6h | 3.1 |
| 3.3 | 収益分析グラフ（8種） | 高 | 8h | 3.1 |
| 3.4 | リスク分析グラフ（6種） | 高 | 6h | 3.1 |
| 3.5 | 戦略分析グラフ（5種） | 中 | 6h | 3.1 |
| 3.6 | モンテカルログラフ（8種） | 中 | 8h | 3.1 |
| 3.7 | 詳細分析グラフ（6種） | 低 | 6h | 3.1 |
| 3.8 | Jupyter Notebookテンプレート | 中 | 6h | 3.2-3.7 |
| 3.9 | レポート出力（JSON/CSV/TXT） | 高 | 4h | Phase2 |
| 3.10 | インタラクティブグラフ（Plotly） | 中 | 6h | 3.2-3.7 |
| 3.11 | グラフエクスポート機能 | 中 | 4h | 3.2-3.7 |
| 3.12 | テスト（可視化） | 高 | 6h | 3.2-3.11 |

### 成果物
- 39種のグラフ生成機能
- Jupyter Notebookテンプレート3種
- JSON/CSV/TXTレポート出力

### マイルストーン判定基準
- [ ] 全39種のグラフが生成可能
- [ ] Jupyter Notebookで対話的分析が可能
- [ ] グラフ生成が30秒以内で完了
- [ ] レポートがファイル出力される

---

## Phase 4: ダッシュボード実装（Week 7-8）

### 目標
- Streamlit Webダッシュボード
- 8ページ構成の完全なUI
- リアルタイムパラメータ調整

### タスク一覧

| ID | タスク | 優先度 | 工数 | 依存 |
|----|--------|-------|------|------|
| 4.1 | Streamlitアプリ基盤 | 高 | 4h | Phase3 |
| 4.2 | ホームページ（概要） | 高 | 4h | 4.1 |
| 4.3 | データ読込ページ | 高 | 6h | 4.1 |
| 4.4 | シミュレーション設定ページ | 高 | 8h | 4.1 |
| 4.5 | 結果表示ページ | 高 | 8h | 4.1 |
| 4.6 | モンテカルロ分析ページ | 中 | 6h | 4.1 |
| 4.7 | 戦略比較ページ | 中 | 6h | 4.1 |
| 4.8 | 詳細分析ページ | 低 | 6h | 4.1 |
| 4.9 | 設定・エクスポートページ | 低 | 4h | 4.1 |
| 4.10 | レスポンシブデザイン対応 | 中 | 4h | 4.2-4.9 |
| 4.11 | セッション状態管理 | 高 | 4h | 4.2-4.9 |
| 4.12 | E2Eテスト | 中 | 6h | 4.2-4.9 |

### 成果物
- 8ページのStreamlitダッシュボード
- リアルタイムパラメータ調整UI
- グラフ・レポートのダウンロード機能

### マイルストーン判定基準
- [ ] `streamlit run` でダッシュボード起動
- [ ] ファイルアップロードでデータ読込
- [ ] スライダー操作でパラメータ調整
- [ ] 結果のダウンロードが可能

---

## Phase 5: 最適化・安定化（Week 9-12）

### 目標
- パフォーマンス最適化
- ドキュメント完備
- v1.0.0リリース

### タスク一覧

| ID | タスク | 優先度 | 工数 | 依存 |
|----|--------|-------|------|------|
| 5.1 | パフォーマンスプロファイリング | 高 | 4h | Phase4 |
| 5.2 | ボトルネック最適化 | 高 | 8h | 5.1 |
| 5.3 | メモリ使用量最適化 | 中 | 6h | 5.1 |
| 5.4 | キャッシュ実装 | 中 | 4h | 5.2 |
| 5.5 | 並列処理実装（モンテカルロ） | 中 | 6h | 5.2 |
| 5.6 | エラーハンドリング強化 | 高 | 6h | Phase4 |
| 5.7 | ログ出力整備 | 中 | 4h | Phase4 |
| 5.8 | READMEドキュメント | 高 | 4h | Phase4 |
| 5.9 | ユーザーガイド作成 | 中 | 6h | Phase4 |
| 5.10 | APIドキュメント生成 | 中 | 4h | Phase4 |
| 5.11 | 全テスト実行・カバレッジ確認 | 高 | 4h | 5.1-5.7 |
| 5.12 | バグ修正・リファクタリング | 高 | 16h | 5.11 |
| 5.13 | リリース準備（PyPI） | 中 | 4h | 5.12 |

### 成果物
- パフォーマンス最適化完了
- 完全なドキュメント
- v1.0.0リリース版

### マイルストーン判定基準
- [ ] 全パフォーマンス目標達成
- [ ] テストカバレッジ 80%以上
- [ ] README/ユーザーガイド完備
- [ ] `pip install` でインストール可能

---

## リソース計画

### 必要スキルセット

| スキル | 必要レベル | 使用フェーズ |
|--------|----------|-------------|
| Python | 上級 | 全フェーズ |
| pandas/numpy | 中級 | Phase 1-3 |
| pytest | 中級 | 全フェーズ |
| matplotlib/plotly | 中級 | Phase 3-4 |
| Streamlit | 中級 | Phase 4 |
| Git | 中級 | 全フェーズ |

### 開発環境

> ⚠️ **重要**: pip installは必ずvenv仮想環境内で実行すること（グローバル環境へのインストール禁止）

```bash
# 推奨開発環境セットアップ
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # macOS/Linux

pip install -e ".[dev]"
pre-commit install
```

---

## リスク管理

### 技術的リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|-------|---------|------|
| パフォーマンス目標未達 | 高 | 中 | 早期プロファイリング、並列化検討 |
| 外部ライブラリ非互換 | 中 | 低 | バージョン固定、テスト自動化 |
| データ形式変更 | 中 | 中 | アダプターパターン採用 |

### スケジュールリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|-------|---------|------|
| Phase 1-2 遅延 | 高 | 中 | MVP範囲の明確化、スコープ調整 |
| 可視化の複雑化 | 中 | 中 | 必須グラフの優先実装 |
| UI要件追加 | 中 | 高 | 機能フリーズ日の設定 |

---

## バージョン計画

### バージョニング方針

```
MAJOR.MINOR.PATCH

MAJOR: 互換性のない変更
MINOR: 後方互換の機能追加
PATCH: 後方互換のバグ修正
```

### リリース計画

| バージョン | 目標日 | 内容 |
|-----------|-------|------|
| v0.1.0 (MVP) | Week 2終了 | コア機能、CLI基本動作 |
| v0.2.0 (α版) | Week 4終了 | 全戦略、モンテカルロ対応 |
| v0.3.0 (β版) | Week 6終了 | 可視化、Jupyter対応 |
| v0.9.0 (RC) | Week 8終了 | Streamlitダッシュボード |
| v1.0.0 | Week 12終了 | 正式リリース |

---

## 品質ゲート

### 各フェーズ完了条件

```
┌─────────────────────────────────────────────────────────────┐
│ Phase 完了チェックリスト                                      │
├─────────────────────────────────────────────────────────────┤
│ □ 全タスク完了                                               │
│ □ ユニットテスト合格率 100%                                  │
│ □ カバレッジ目標達成                                         │
│ □ 静的解析エラー 0件（ruff, mypy）                           │
│ □ マイルストーン判定基準クリア                               │
│ □ コードレビュー完了（セルフレビュー可）                      │
│ □ ドキュメント更新                                           │
└─────────────────────────────────────────────────────────────┘
```

### コード品質基準

| 項目 | 基準 |
|------|------|
| 型ヒント | 全public関数に付与 |
| docstring | 全public関数/クラスに付与 |
| 行長 | 88文字以下（black準拠） |
| 複雑度 | 関数あたり循環的複雑度 10以下 |
| テスト | 関数あたり最低1テストケース |

---

## 開発フロー

### Git ブランチ戦略

```
main (安定版)
  │
  ├── develop (開発統合)
  │     │
  │     ├── feature/phase1-data-loader
  │     ├── feature/phase2-kelly-fund
  │     ├── feature/phase3-charts
  │     └── feature/phase4-dashboard
  │
  └── release/v1.0.0
```

### コミットメッセージ規約

```
<type>(<scope>): <subject>

<type>:
  feat:     新機能
  fix:      バグ修正
  docs:     ドキュメント
  style:    フォーマット
  refactor: リファクタリング
  test:     テスト追加
  chore:    ビルド・ツール

例:
feat(strategy): Add Kelly criterion fund manager
fix(evaluator): Fix quinella hit detection for reversed order
docs(readme): Add installation instructions
```

---

## 依存関係図

```
                    ┌─────────────┐
                    │   models    │
                    │ (dataclass) │
                    └──────┬──────┘
                           │
         ┌─────────────────┼─────────────────┐
         │                 │                 │
         ▼                 ▼                 ▼
  ┌────────────┐   ┌────────────┐   ┌────────────┐
  │ DataLoader │   │  Strategy  │   │FundManager │
  └─────┬──────┘   └─────┬──────┘   └─────┬──────┘
        │                │                 │
        └────────────────┼─────────────────┘
                         │
                         ▼
              ┌─────────────────────┐
              │  SimulationEngine   │
              └──────────┬──────────┘
                         │
         ┌───────────────┼───────────────┐
         │               │               │
         ▼               ▼               ▼
  ┌────────────┐  ┌────────────┐  ┌────────────┐
  │BetEvaluator│  │  Metrics   │  │ChartGen    │
  └────────────┘  │ Calculator │  │(Phase 3)   │
                  └────────────┘  └────────────┘
                         │
                         ▼
              ┌─────────────────────┐
              │   CLI / Streamlit   │
              │     (Phase 4)       │
              └─────────────────────┘
```

---

## クイックスタート（開発者向け）

### Day 1: 環境セットアップ

```bash
# リポジトリクローン
git clone <repo-url>
cd KirisameBettingSimulation

# Python環境作成
python -m venv venv
venv\Scripts\activate  # Windows

# 開発用依存インストール
pip install -e ".[dev]"

# pre-commit設定
pre-commit install

# テスト実行確認
pytest
```

### 最初のタスク

1. `src/betting_simulation/__init__.py` 作成
2. `src/betting_simulation/models.py` でデータクラス定義
3. テストファイル `tests/unit/test_models.py` 作成
4. 実装 → テスト → コミット のサイクル開始

---

**文書情報**
- 作成日: 2026-01-21
- バージョン: 1.0.0
- 関連文書: 全技術ドキュメント
